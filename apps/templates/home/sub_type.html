
{% extends "layouts/base.html" %} {% block title %} Project {% endblock %}
{% block stylesheets %}
    <style>
    .dropdown-container {
    position: relative;
  }

  .dropdown-options {
    display: none;
    position: absolute;
    background-color: white;
    border: 1px solid #ddd;
    z-index: 1000;
    width: 100%;
    max-height: 200px;
    overflow-y: auto;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    padding: 10px; /* Optional padding */
    box-sizing: border-box;
  }

  .dropdown-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* Two columns */
    gap: 10px; /* Space between columns */
    align-items: center; /* Align items in the center vertically */
  }

  .dropdown-col {
    display: flex;
    flex-direction: column;
    gap: 5px; /* Space between rows within the column */
  }
   .form-check {
    display: flex;
    align-items: center;
    overflow: hidden; /* Hide overflow */
    text-overflow: ellipsis; /* Add ellipsis for long text */
    white-space: nowrap; /* Prevent line breaks */
    width: 100%; /* Ensure it takes full width of the column */
  }

  .form-check-label {
    flex: 1; /* Allow label to grow */
    margin-left: 5px; /* Space between checkbox and label */
  }

  .form-control {
    cursor: pointer;
  }
      .progress-bar-container {
      background-color: #f3f3f3; /* Background color of the progress bar container */
      border-radius: 4px;
      height: 20px; /* Adjust the height as needed */
      width: 100%; /* Full width of the container */
      margin-top: 10px; /* Space between the card content and the progress bar */
    }
    
    .progress-bar-todo {
    height: 100%;
    text-align: center;
    line-height: 20px; /* Center text vertically */
    border-radius: 4px;
    background-color: #ab1b0c; /* Default color for progress */
    color: white; /* Default text color */
    white-space: nowrap; /* Prevent text wrapping */
  }
    
    .progress-bar-done {
      background-color: #4caf50; /* Color of the progress bar */
      height: 100%;
      color: white;
      text-align: center;
      line-height: 20px; /* Center text vertically */
      border-radius: 4px;
      white-space: nowrap; 
    }
    .progress-bar-zero {
      background-color: gray !important; /* Color when 0% */
    color: black !important;
    width: 10%;
  }
    </style>

    
<!-- Google Font: Source Sans Pro -->
<link
rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
/>
<!-- Font Awesome -->
<link
rel="stylesheet"
href="/static/assets/plugins/fontawesome-free/css/all.min.css"
/>
<!-- DataTables -->
<link
rel="stylesheet"
href="/static/assets/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css"
/>
<link
rel="stylesheet"
href="/static/assets/plugins/datatables-responsive/css/responsive.bootstrap4.min.css"
/>
<!-- Theme style -->
<link rel="stylesheet" href="/static/assets/css/adminlte.min.css" />
<link rel="stylesheet" href="/static/assets/plugins/toastr/toastr.min.css" />
<link
rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
/>
{% endblock stylesheets %} {% block content %}
<div class="content-wrapper">
  <!-- Page header -->
  <section class="content-header" id="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1>{{ project_name }}</h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="/Project">Back</a></li>
         
          </ol>
        </div>
      </div>
    </div>
  </section>
      <section class="content" >
        <div class="container-fluid">
          <!-- Small boxes (Stat box) -->
          <div class="cardBox">
            <div class="card">
              <div>
                <div class="cardName">Total Task</div>
                <div class="numbers">{{ subtype_count }}</div>
                
                <!-- Icon -->
                <div class="iconBx">
                  <ion-icon name="layers-outline"></ion-icon> <!-- Use this or another appropriate icon -->
                </div>
              </div>         
          
                
            </div>
           
            <div class="card">
              <div>
                <div class="cardName">To-Do Tasks</div>
                <div class="numbers">{{ status_counts['To-Do'] }}</div>
                <div class="iconBx">
                  <ion-icon name="list-outline"></ion-icon>
                </div>
                <div class="progress-bar-container mt-3">
                  <div class="progress-bar-todo {{ 'progress-bar-zero' if todo_percentage == 0 else '' }}" 
                       style="width: {{ todo_percentage }}%;">
                    {{ todo_percentage }}%
                  </div>
                </div>
              </div>
            </div>
            
            
            
            <div class="card">
              <div>
                <div class="cardName">Done Tasks</div>
                <div class="numbers">{{ status_counts['Done'] }}</div>
                <div class="iconBx">
                  <ion-icon name="checkbox-outline"></ion-icon>
                </div>
                <div class="progress-bar-container mt-3">
                  <div class="progress-bar-done {{ 'progress-bar-zero' if done_percentage == 0 else '' }}" style="width: {{ done_percentage }}%;">
                    {{ done_percentage }}%
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card">
              <div>
                <div class="cardName">Total Engineers</div>
                <div class="numbers">{{ total_engineers }}</div>
                <div class="iconBx">
                  <ion-icon name="people-outline"></ion-icon>
                </div>
              </div>
            </div>
            
        
          </div>
      </div>

      <!-- /.row -->
      <!-- Main row -->
      <div class="details">
        <div class="recentOrders">
          <div class="cardHeader">
            <h2>{{ project_type }}</h2>
            <form action="{{ url_for('home_blueprint.view_all_subtype') }}" method='POST'>
              <input type="hidden" name="project_name" value="{{ project_name }}">
              <input type="hidden" name="project_type" value="{{ project_type }}">
              <input type="hidden" name="project_dut" value="{{ project_dut }}">
              <button type="submit"  class="view">View All</button>
          </form>
          
        </div>
        
            <div class="table_body">
                <table id="subtype_table">
                    <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Types</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if subtypes %}
                            {% for subtype in subtypes %}
                            <tr>
                                <td>{{ loop.index }}</td>
                              
                                <td>
                                    <form
                                      action="{{ url_for('home_blueprint.subtype_details') }}"
                                      method="POST"
                                    >
                                      <input
                                        type="hidden"
                                        name="project_name"
                                        value="{{ project_name }}"
                                      />
                                      <input
                                        type="hidden"
                                        name="project_type"
                                        value="{{ project_type }}"
                                      />
                                      <input
                                        type="hidden"
                                        name="project_dut"
                                        value="{{ project_dut }}"
                                      />
                                      <input
                                        type="hidden"
                                        name="subtype_name"
                                        value="{{ subtype['subtype_name'] }}"
                                      />
                                      <button type="submit" style="border: none; background: transparent; color: blue">
                                        {{ subtype['subtype_name'] }}
                                      </button>
                                    </form>
              
                                </td>
                                
                              
                                 <td>
                                    <span class="status {{ subtype['status']}}">{{ subtype['status'] }}</span>
                                </td>
                              
                            </tr>
                            {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="3">No types found.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
           
        </div>

        <div class="recentCustomers">
          <div class="cardHeader">
            <h2>Details</h2>
            <a href="#" class="btn" data-toggle="modal" data-target="#edit_conf">Edit</a>
          </div>
        
          <table>
            <tr>
              <td>
                <div class="label">Authorizer</div>
              </td>
              <td>
                <span class="authorizer-value">{{ authorizer }}</span>
              </td>
            </tr>
            
            <tr>
              <td>
                <div class="label">Reporting Manager</div>
              </td>
              <td>
                <span class="reporting-manager-value">{{ reporting_manager }}</span>
              </td>
            </tr>

            <tr>
              <td>
                <div class="label">Test Engineers </div>
              </td>
              <td>
                <span class="engineer_names-value">{{ engineer_names }}</span>
              </td>
            </tr>

            <tr>
              <td>
                <div class="label">Created Date</div>
              </td>
              <td>
                <span class="created_date-value">{{ created_date}}</span>
              </td>
            </tr>

            <tr>
          
              <td>
                <div class="label">Report Details</div>
              </td>
              <td>
                <span class="report_detail-value">
                    <a href="#" class="btn-report" 
                       data-toggle="modal" 
                       data-target="#view-report" 
                       data-details='{{ report_details | tojson | safe }}'>View Detail</a>
                </span>
            </td>



              <!-- <td>
                <span class="created_date-value"><a href="#" class="btn-report" data-toggle="modal" data-target="#add-report">Add Detail</a></span>
              </td> -->
             
            </tr>

          </table>
        </div>

        <!-- Modal Structure -->
     
        <div class="modal fade" id="view-report" tabindex="-1" role="dialog" aria-labelledby="viewReportLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="viewReportLabel">Report Details</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <div id="report-details-container"></div>
                  </div>
                  <div class="modal-footer d-flex justify-content-between">
                    <button type="button" class="btn btn-primary btn-report" data-toggle="modal" data-target="#add-report">
                        Add
                    </button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        Close
                    </button>
                </div>
                
                
              </div>
          </div>
      </div>

          
        <div class="modal fade" id="test_conf">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title">Details</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="card">
                  <div class="card-body">
                    <table id="example2" class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th class="text-center">S.No</th>
                          <th class="text-center">Date</th>
                          <th class="text-center">Project Name</th>
                          <th class="text-center">Agent Name</th>
                          <th class="text-center">Engineer Names</th>
                          <!-- <th class="text-center">Action</th> -->
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="add-report">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title">Add Details</h4>
                
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              
              <div class="modal-body">
                <div class="card">

                  <!-- Add Button for New Rows in Top Right Corner -->
                  <div class="d-flex justify-content-between">
                    <!-- Upload JSON Button -->
                    <button type="button" id="uploadJson" class="btn btn-secondary mb-3" data-project-id="{{ project_id }}">
                      <i class="fas fa-file-upload"></i> Upload JSON
                  </button>
                  

                    <input type="file" id="jsonFileInput" accept=".json" style="display: none; margin-top: -5px;">

                    <button type="button" id="addDetail" class="btn btn-primary mb-3" style="margin-top: -5px;">
                      <i class="fas fa-plus"></i>
                    </button>
                  </div>
                  <div class="card-body">
                    <form method="post" action="{{ url_for('home_blueprint.add_report', project_id=project_id) }}" enctype="multipart/form-data">

                        <input type="hidden" name="project_id" value="{{ project_id }}" />
                        <input type="hidden" name="project_name" value="{{ project_name }}">
                        <input type="hidden" name="project_type" value="{{ project_type }}">
                        <input type="hidden" name="project_dut" value="{{ project_dut }}">
                      
                      <!-- Container for Detail Rows -->
                      <div id="detailsContainer">
                        <div class="row detail position-relative">
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label for="detailKey">Report Key</label>
                              <input type="text" class="form-control" name="detail_key[]" placeholder="Detail Key" required>
                            </div>
                          </div>
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label for="detailValue">Report Value</label>
                              <input type="text" class="form-control" name="detail_value[]" placeholder="Detail Value" required>
                            </div>
                          </div>
                          <button type="button" class="removeDetail btn btn-danger btn-sm position-absolute" 
                                  style="top: 5px; right: 5px; width: 24px; height: 24px; padding: 0;">
                            <i class="fas fa-minus" style="font-size: 12px;"></i>
                          </button>
                        </div>
                      </div>
        
                      <!-- Modal Footer for Close and Submit -->
                      <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- JavaScript for JSON Upload -->
      
        <script>
          document.getElementById("uploadJson").addEventListener("click", function() {
              document.getElementById("jsonFileInput").click();  // Open file dialog
          });

          document.getElementById("jsonFileInput").addEventListener("change", function(event) {
              const file = event.target.files[0];
              const projectId = document.getElementById("uploadJson").dataset.projectId;  // Get project_id here

              if (file) {
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      try {
                          const jsonData = JSON.parse(e.target.result);
                          console.log("Uploaded JSON Data:", jsonData);
                          
                          // Send JSON data to the server via AJAX
                          fetch(`/add_report/${projectId}`, {  // Use projectId variable
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/json',
                                  'X-CSRFToken': "{{ csrf_token }}"  // CSRF token if enabled
                              },
                              body: JSON.stringify({
                                  project_name: "{{ project_name }}",
                                  project_type: "{{ project_type }}",
                                  project_dut: "{{ project_dut }}",
                                  report_details: jsonData
                              })
                          })
                          .then(response => response.json())
                          .then(data => {
                              if (data.success) {
                                // Redirect to view_subtypes page
                                window.location.href = `/view_subtypes?project_name=${encodeURIComponent("{{ project_name }}")}&project_type=${encodeURIComponent("{{ project_type }}")}&project_dut=${encodeURIComponent("{{ project_dut }}")}`;
                                  
                              } else {
                                  Swal.fire({
                                      title: "Error",
                                      text: "Failed to add report details.",
                                      icon: "error",
                                      confirmButtonText: "OK"
                                  });
                              }
                          })
                          .catch(error => console.error("Error uploading JSON data:", error));

                      } catch (error) {
                          console.error("Error parsing JSON file:", error);
                          Swal.fire({
                              title: "Invalid JSON",
                              text: "Invalid JSON file. Please try again.",
                              icon: "error",
                              confirmButtonText: "OK"
                          });
                      }
                  };
                  reader.readAsText(file);
              }
          });
        </script>
        
        <script>
          // Function to Add New Detail Row
          document.getElementById('addDetail').addEventListener('click', function() {
            const detailDiv = document.createElement('div');
            detailDiv.classList.add('row', 'detail', 'position-relative', 'mt-3');
            detailDiv.innerHTML = `
              <div class="col-sm-6">
                <div class="form-group">
                  <label>Report Key</label>
                  <input type="text" class="form-control" name="detail_key[]" placeholder="Detail Key" required>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label>Report Value</label>
                  <input type="text" class="form-control" name="detail_value[]" placeholder="Detail Value" required>
                </div>
              </div>
              <button type="button" class="removeDetail btn btn-danger btn-sm position-absolute" 
                                  style="top: 5px; right: 5px; width: 24px; height: 24px; padding: 0;">
                            <i class="fas fa-minus" style="font-size: 12px;"></i>
                          </button>
            `;
            document.getElementById('detailsContainer').appendChild(detailDiv);
          });
        
          // Event Delegation for Removing Detail Rows
          document.getElementById('detailsContainer').addEventListener('click', function(e) {
            if (e.target.classList.contains('removeDetail') || e.target.closest('.removeDetail')) {
              e.target.closest('.detail').remove();
            }
          });
        </script>
        

        <div class="modal fade" id="edit_conf">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title">Edit Project</h4>
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="card">
                  <div class="card-body">
                    <div class="tab-content">
                      <div class="active tab-pane" id="project">
                        <form method="post" action="{{ url_for('home_blueprint.edit_project', project_id=project_id) }}" enctype="multipart/form-data">
 
                          <input type="hidden" name="project_id" value="{{ project_id }}" />

                          <div class="row">
                            <div class="col-sm-6">
                              <div class="form-group">
                                <label for="name">Project Name</label>
                                <input
                                  type="text"
                                  name="name"
                                  class="form-control"
                                  value="{{ project_name }}"
                                  required
                                />
                              </div>
                            </div>
                            <div class="col-sm-6">
                              <div class="form-group">
                                <label for="Auth">Authorizer</label>
                                <input
                                  type="text"
                                  name="Auth"
                                  class="form-control"
                                  value="{{ authorizer }}"
                                  required
                                />
                              </div>
                            </div>
                          </div>
        
                          <div class="row">
                            <div class="col-sm-6">
                              <div class="form-group">
                                <label for="RM">Reporting Manager</label>
                                <input
                                  type="text"
                                  name="RM"
                                  class="form-control"
                                  value="{{ reporting_manager }}"
                                  required
                                />
                              </div>
                            </div>
                            
                            <div class="col-sm-6">
                              <div class="form-group">
                                  <label for="engineer-input" onclick="toggleDropdown(event)">Engineers</label>
                                  <div class="dropdown-container">
                                      <input
                                          type="text"
                                          name="engineers"
                                          id="engineer-input"
                                          class="form-control"
                                          readonly
                                          value="{{engineer_names}}"
                                          onclick="toggleDropdown(event)"
                                      />
                                      <div id="engineer-checkboxes" class="dropdown-options" style="display: none;">
                                          <div class="dropdown-row">
                                              {% for engineer_name in engineer_names_list_option %}
                                                  <div class="dropdown-col">
                                                      <div class="form-check">
                                                          <input type="checkbox" value="{{ engineer_name }}" onchange="updateLabel()" id="checkbox-{{ loop.index }}" />
                                                          <label class="form-check-label" for="checkbox-{{ loop.index }}">
                                                              {{ engineer_name }}
                                                          </label>
                                                      </div>
                                                  </div>
                                              {% endfor %}
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          
                         </div>
                          
                          
                            
        
                          <div class="row">
                            <div class="col-sm-6">
                              <div class="form-group">
                                <label for="Pro_Type">Project Type</label>
                                <select name="Pro_Type" class="form-control">
                                  {% for type_name in project_types_list %}
                                    <option value="{{ type_name }}" {% if type_name == project_type %} selected {% endif %}>{{ type_name }}</option>
                                  {% endfor %}
                                </select>
                              </div>
                            </div>
                           
                            <div class="col-sm-6">
                              <div class="form-group">
                                <label for="Dut">Dut</label>
                                <select name="Dut" class="form-control">
                                  {% for product_no in product_numbers %}
                                    <option value="{{ product_no }}" {% if product_no == project_dut %} selected {% endif %}>{{ product_no }}</option>
                                  {% endfor %}
                                </select>
                              </div>
                            </div>
                          </div>
        
                          <div class="modal-footer justify-content-between">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Submit</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        

           
    </section>
  </div>
  <!-- /.card -->

<!-- /.content-wrapper -->
{% endblock content %} {% block javascripts %}
  <script src="/static/assets/plugins/jquery/jquery.min.js"></script>
  <script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/static/assets/plugins/datatables/jquery.dataTables.min.js"></script>
  <script src="/static/assets/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
  <script src="/static/assets/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
  <script src="/static/assets/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
  <script src="/static/assets/js/adminlte.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <script src="/static/assets/js/demo.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Include jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

  <script>
    $(function () {
      // Initialize DataTable
      $("#subtype_table").DataTable({
        "responsive": true,
        "autoWidth": false,
      });
      $("#example2").DataTable({
      responsive: true,
      autoWidth: false,
    });
      
    });
  </script>
  <script>
  
    function toggleDropdown(event) {
        const checkboxesContainer = document.getElementById('engineer-checkboxes');
        checkboxesContainer.style.display = checkboxesContainer.style.display === 'none' ? 'block' : 'none';
        event.preventDefault();
    }

    function updateLabel() {
        const checkboxes = document.querySelectorAll('#engineer-checkboxes input[type="checkbox"]');
        const selectedOptions = Array.from(checkboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.value);
        
        const label = document.getElementById('engineer-input');
        label.value = selectedOptions.length > 0 ? selectedOptions.join(', ') : 'Select engineers';
    }

 //  Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
            const checkboxesContainer = document.getElementById('engineer-checkboxes');
            const engineerInput = document.getElementById('engineer-input');
            if (!engineerInput.contains(event.target) && !checkboxesContainer.contains(event.target)) {
                checkboxesContainer.style.display = 'none';
            }
        });
</script>
  <!-- next page -->
  <script>
  $(document).ready(function() {
  $('.subtype-link').on('click', function(event) {
    event.preventDefault(); // Prevent the default link behavior

    var subtypeName = $(this).data('subtype-name'); // Get the subtype name

    // Send an AJAX GET request to fetch subtype details
    $.ajax({
      url: '/subtype-details',
      type: 'GET',
      data: { subtype_name: subtypeName },
      success: function(response) {
        var tbody = $('#example2 tbody');
        tbody.empty(); // Clear any existing rows

        if (response.uploads && response.uploads.length > 0) {
          $.each(response.uploads, function(index, upload) {
            var row = `
            <tr>
            <td class="text-center">${index + 1}</td>
            <td class="text-center">${upload[6]}</td> <!-- Upload date -->
            <td class="text-center">${upload[7]}
            <td class="text-center">${upload[1]}</td> <!-- Agent name -->
            <td class="text-center">${upload[8] ? upload[8].join(', ') : 'No engineers'}</td> <!-- Engineer names -->
          </tr>`;
            tbody.append(row);
          });
        } else {
          tbody.append('<tr><td colspan="6" class="text-center">No file uploads available.</td></tr>');
        }
      },
      error: function(xhr, status, error) {
        console.error('Error fetching subtype details:', error);
      }
    });
  });
});

$(document).ready(function() {
  // Add click event to the subtype links
  $(document).on("click", ".subtype-link", function(event) {
    event.preventDefault(); // Prevent the default link behavior

    // Get the subtype name and project name from the clicked element's data attributes
    var subtypeName = $(this).data("subtype-name");
    var projectName = $(this).data("project-name");
    var projectType = $(this).data("project-type");
    var projectDut = $(this).data("project-dut");
    
    console.log("subtypeName:", subtypeName);
    console.log("projectName:", projectName);
    console.log("projectType:", projectType);
    console.log("projectDut:", projectDut);

    // Make an AJAX call to fetch the details for the clicked subtype
    $.ajax({
      url: "{{ url_for('home_blueprint.subtype_details') }}",
      type: "GET",
      data: {
        subtype_name: subtypeName,
        project_name: projectName,
        project_type: projectType,
        project_dut: projectDut
      },
      success: function(response) {
        $("#report-section").show();
        $("#report-container").html(response); 
      },
      error: function(xhr, status, error) {
        console.log("Error:", error);
      }
    });
  });
});



$(document).ready(function() {
  // Add click event to the subtype links
  $(document).on("click", ".btn-1", function(event) {
    event.preventDefault(); // Prevent the default link behavior

    // Get the subtype name from the clicked element's data attribute
    var project_type = $(this).data("project_type");
    var projectName = $(this).data("project-name");
    console.log("project_type:", project_type);
    console.log("projectName:", projectName);
    // Make an AJAX call to fetch the details for the clicked subtype
    $.ajax({
      url: "{{ url_for('home_blueprint.view_all_subtype') }}",
      type: "GET",  
      data: {
        project_type: project_type,
        project_name: projectName
        },
        
      success: function(response) {
        $("#report-section").show();
          $("#report-container").html(response); 
  },
  error: function(xhr, status, error) {
    console.log("Error:", error);
  }
});

  });
});
  </script>

<script>
  const reportDetails = JSON.parse('{{ report_details | safe }}');

if (reportDetails.status === "success" && Array.isArray(reportDetails.data)) {
    let detailsHTML = '<table><tr><th>Key</th><th>Value</th><th>Action</th></tr>';

    reportDetails.data.forEach((item) => {
        detailsHTML += `
            <tr id="row-${item.key}">
                <td>${item.key}</td>
                <td>${item.value}</td>
                <td><button 
        onclick="deleteItem('${item.key}')"
        style="
            background-color: transparent; 
            border: none; 
            cursor: pointer; 
            padding: 0;
        ">
        <i class="fas fa-trash" style="color: #007bff;"></i>
    </button></td>
            </tr>
        `;
    });

    detailsHTML += '</table>';

    document.getElementById("report-details-container").innerHTML = detailsHTML;
} else {
    document.getElementById("report-details-container").innerHTML = "<p>Error loading report details.</p>";
}

function deleteItem(key) {
    // Remove the row from the table in the UI
    const row = document.querySelector(`#row-${key}`);
    if (row) {
        row.remove();
    }

    // Make an AJAX call to delete the item on the server side
    fetch('/delete-item', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ key: key }) // Send the key instead of item_id
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === "success") {
            // Find the row in the table by key and remove it from the DOM
            const row = document.getElementById(`row-${key}`);
            if (row) {
                row.remove();
            }
            console.log("Item deleted successfully.");
        } else {
            console.error("Failed to delete item:", data.message);
        }
    })
    .catch(error => console.error("Error:", error));
}

</script>


  


  <style>

#view-report .modal-body,
#detailsContainer {
    max-height: 300px; 
    overflow-y: auto; 
    overflow-x: auto; 
    scrollbar-width: thin; 
    scrollbar-color: #888 #f1f1f1;
}

/* For WebKit browsers (Chrome, Safari) */
#view-report .modal-body::-webkit-scrollbar,
#detailsContainer::-webkit-scrollbar {
    width: 6px;  
    height: 6px; 
}

/* Track */
#view-report .modal-body::-webkit-scrollbar-track,
#detailsContainer::-webkit-scrollbar-track {
    background: #f1f1f1; /* Background color of the track */
}

/* Handle */
#view-report .modal-body::-webkit-scrollbar-thumb,
#detailsContainer::-webkit-scrollbar-thumb {
    background: #888; /* Color of the scrollbar handle */
    border-radius: 10px; /* Round the corners of the handle */
}

/* Handle on hover */
#view-report .modal-body::-webkit-scrollbar-thumb:hover,
#detailsContainer::-webkit-scrollbar-thumb:hover {
    background: #555; /* Color of the scrollbar handle when hovered */
}


.cardHeader h2 {
  font-size: 24px;
  font-weight: bold;
  color: #333;
  margin-bottom: 20px;
}

.label {
  color: var(--black2);
  font-size: 1.1rem;
  padding-right: 10px; 
  padding-bottom: 5px; 
  vertical-align: top; 
  /* Adjust this value to decrease the width */
  display: inline-block; /* Ensure the div shrinks to fit content */
}


table {
  width: 100%;
  border-collapse: collapse;
}

td {
  padding: 10px 0;
  vertical-align: top; 
}

.recentCustomers table tr td {
  text-align: center; /* Horizontally center-align content */
  padding: 12px 10px;
  vertical-align: top;
  width: 120px;
   /* Ensure content starts from the top */
}

.recentCustomers table tr td span {
  display: block; 
  text-align: left;
  font-size: 16px;
  font-weight: 500;
  margin-left: -10px;
}
/* Optional: Add borders between rows */
tr {
  border-bottom: 1px solid #ddd;
}

      /* Table styling
      #example3 {
      width: 100%;
      border-collapse: collapse;
    }

    #example3 tbody td {
      padding: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);/* Light gray border at the bottom of table cells */
    /* }

    #example3 thead th {
      padding: 10px;
      text-align: left;
      /* background: #f9f9f9;} */
    /* =========== Google Fonts ============ */


/* ======================= Cards ====================== */
.cardBox {
  position: relative;
  width: 100%;
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-gap: 30px;
}

.cardBox .card {
  position: relative;
  background: var(--white);
  padding: 30px;
  border-radius: 20px;
  display: flex;
  justify-content: space-between;
  cursor: pointer;
  box-shadow: 0 7px 25px rgba(0, 0, 0, 0.08);
  border: 2px solid transparent; /* Set initial border to transparent */
  border-image: linear-gradient(45deg, #f5f5f5, #e0e0e0); /* Very light gradient colors */
  border-image-slice: 1; /* Ensure the gradient covers the border */
}

.cardBox .card .title {
  font-weight: 700;
  font-size: 24px;
  color: black; 
  margin: 0 0 10px;
  position: relative;
}


.cardBox .card .numbers {
  position: relative;
  font-weight: 400;
  font-size: 2rem;
  color: var(--blue);
}

.cardBox .card .cardName {
  color: var(--black2);
  font-size: 1.1rem;
  margin-top: 5px;
}

.cardBox .card .iconBx {
  position: absolute;  /* Position the icon absolutely */
  top: 50%;            /* Vertically center the icon */
  right: 20px;         /* Align it to the right */
  transform: translateY(-50%);  /* Adjust to ensure perfect vertical centering */
  font-size: 3.5rem;
  color: var(--black2);
}

.cardBox .card:hover {
  background: var(--gray);
}
.cardBox .card:hover .numbers,
.cardBox .card:hover .cardName,
.cardBox .card:hover .iconBx {
  color: black;
}

/* ================== Order Details List ============== */
/* ================== Order Details List ============== */
.details {
  position: relative;
  width: 100%;
  padding: 20px;
  display: grid;
  grid-template-columns: 2fr 1fr;
  grid-gap: 30px;
}

.details .recentOrders {
  position: relative;
  display: flex; /* Use flexbox for alignment */
  flex-direction: column; /* Stack children vertically */
  min-height: 500px;
  background: var(--white);
  padding: 20px;
  box-shadow: 0 7px 25px rgba(0, 0, 0, 0.08);
  border-radius: 20px;
  border: 2px solid transparent;
  border-image: linear-gradient(45deg, #f5f5f5, #e0e0e0);
  border-image-slice: 1;
}

.details .cardHeader {
  display: flex;
  justify-content: space-between;
  align-items: center; /* Center items vertically */
  margin-bottom: 10px; /* Space between header and table */
}

.table_body {
  flex: 1; /* Allow the table body to take up remaining space */
}


.details table {
  width: 100%;
  border-collapse: collapse;
}

.details table thead th {
  font-weight: 600;
  background: #f4f4f4;
  color: var(--blue);
  padding: 10px;
  text-align: left;
  vertical-align: top;
}

.details table tbody tr {
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.details table tbody tr:last-child {
  border-bottom: none;
}

.details table tbody tr:hover {
  background: var(--gray);
  color: black;
}

.details table td {
  padding: 10px;
  vertical-align: top;
}

.details table td:nth-child(1),
.details table td:nth-child(2),
.details table td:nth-child(3),
.details table td:nth-child(4) {
  text-align: left;
}

.cardHeader .btn {
  position: relative;
  padding: 5px 10px;
  background: var(--blue);
  text-decoration: none;
  color: var(--white);
  border-radius: 6px;
}

.cardHeader .view {
  position: relative;
  padding: 5px 10px;
  background: var(--blue);
  text-decoration: none;
  color: var(--white);
  border-radius: 6px;
}


.status.To-Do {
    padding: 2px 4px;
    background: #ab1b0c ;
    color: var(--white);
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
}
.status.To-Do {
    padding: 2px 4px;
    background: #ab1b0c ;
    color: var(--white);
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
}

.status.Progress {
    padding: 2px 4px;
    background: #f7c04b;
    color: var(--white);
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
}

.status.Done {
    padding: 2px 4px;
    background: #4caf50; 
    color: var(--white);
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
}

.recentCustomers {
  display: flex;
  flex-direction: column; 
  min-height: 500px;
  padding: 20px;
  background: var(--white);
  box-shadow: 0 7px 25px rgba(0, 0, 0, 0.08);
  border-radius: 20px;
  border: 2px solid transparent;
  border-image: linear-gradient(45deg, #f5f5f5, #e0e0e0);
  border-image-slice: 1;
}
.recentCustomers .imgBx {
  position: relative;
  width: 40px;
  height: 40px;
  border-radius: 50px;
  overflow: hidden;
}
.recentCustomers .imgBx img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.recentCustomers table tr {
  align-items: flex-start; 
  justify-content: flex-start; 
}

.recentCustomers table tr td h4 {
  font-size: 16px;
  font-weight: 500;
  line-height: 1.2rem;
}
.recentCustomers table tr td h4 span {
  font-size: 14px;
  color: var(--black2);
}
.recentCustomers table tr:hover {
  background: var(--blue);
  color: var(--white);
}
.recentCustomers table tr:hover td h4 span {
  color: var(--white);
}

  </style>
{% endblock javascripts %}

